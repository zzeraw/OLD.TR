$(function(){Array.prototype.max=function(){return Math.max.apply(Math,this)},Array.prototype.min=function(){return Math.min.apply(Math,this)};var a={init:function(a){this.config=a,this.setupTemplates(),this.bindEvents()},bindEvents:function(){this.config.addNewGroupButton.on("click",this.addNewGroup),this.config.addNewCollectionButton.on("click",this.addNewCollection),this.config.body.on("click",this.config.addNewColorButton.selector,this.addNewColor),this.config.body.on("click",this.config.addNewImageInNewColorButton.selector,this.addNewImageOfNewColor),this.config.addNewImageInExistingColorButton.on("click",this.addNewImageOfExistingColor),this.config.body.on("click",this.config.removeNewBlockButton.selector,this.removeNewElement),$(".remove-exist-color").on("click",function(){var a={field_name:"color",field_value:$(this).closest(".element-item").data("exist_color")},b=$("#remove-hidden-filed-template").html(),c=Handlebars.compile(b);$(".remove-exist-colors").append(c(a)),$(this).closest(".element-item").remove()}),$(".remove-exist-image").on("click",function(){var a={field_name:"image",field_value:$(this).closest(".element-item").data("image")},b=$("#remove-hidden-filed-template").html(),c=Handlebars.compile(b);$(".remove-exist-images").append(c(a)),$(this).closest(".element-item").remove()}),$(".remove-exist-group").on("click",function(){var a={field_name:"group",field_value:$(this).closest(".element-item").data("group")},b=$("#remove-hidden-filed-template").html(),c=Handlebars.compile(b);$(".remove-exist-groups").append(c(a)),$(this).closest(".element-item").remove()}),$(".remove-exist-collection").on("click",function(){var a={field_name:"collection",field_value:$(this).closest(".element-item").data("collection")},b=$("#remove-hidden-filed-template").html(),c=Handlebars.compile(b);$(".remove-exist-collections").append(c(a)),$(this).closest(".element-item").remove()}),$("body").on("click",".catalog-color .color-select",function(){var a=$(this).data("color"),b=$(this).closest(".catalog-block").data("exist_color");$(this).closest(".catalog-block").find(".color-select").removeClass("color-preview-selected"),$(this).addClass("color-preview-selected"),$('.hidden-block input[name="exist_color['+b+']"]').val(a)}),$("body").on("click",".catalog-new-color .color-select",function(){$(this).data("color"),$(this).closest(".catalog-block").data("new_color"),$(this).closest(".catalog-block").find(".color-select").removeClass("color-preview-selected"),$(this).addClass("color-preview-selected")}),$("#submit-form").on("click",function(){$(".catalog-new-color").each(function(){var b=$(this).find(".color-preview-selected").data("color"),c=$(this).data("new_color"),d={color_value:b,new_color_id:c},e=$("#new-color-hidden-field-template").html(),f=Handlebars.compile(e);$(".new-colors-fields").append(f(d))})})},setupTemplates:function(){this.config.addGroupTemplate!==void 0&&(this.config.addGroupTemplate=Handlebars.compile(this.config.addGroupTemplate)),this.config.addCollectionTemplate!==void 0&&(this.config.addCollectionTemplate=Handlebars.compile(this.config.addCollectionTemplate)),this.config.addCollectionTemplate!==void 0&&(this.config.addImageInNewColorTemplate=Handlebars.compile(this.config.addImageInNewColorTemplate)),this.config.addImageInExistingColorTemplate!==void 0&&(this.config.addImageInExistingColorTemplate=Handlebars.compile(this.config.addImageInExistingColorTemplate)),this.config.addNewColorTemplate!==void 0&&(this.config.addNewColorTemplate=Handlebars.compile(this.config.addNewColorTemplate))},addNewGroup:function(){a.config.newGroupsBlock.append(a.config.addGroupTemplate())},addNewCollection:function(){a.config.newCollectionsBlock.append(a.config.addCollectionTemplate())},addNewColor:function(){var b=[-1];$(a.config.blocksOfNewColor.selector).each(function(){b.push($(this).data("new_color"))});var c=b.max()+1,d={new_color_counter:c};a.config.newColorsBlock.append(a.config.addNewColorTemplate(d))},addNewImageOfNewColor:function(){var b=$(this).closest(".controls").find(".element-item input"),c=0;if(0!=b.length){var d=[];b.each(function(){d.push($(this).data("images_counter"))}),c=d.max()+1}var e=$(this).closest(a.config.blocksOfNewColor.selector).data("new_color"),f={new_color_id:e,images_counter:c};$(this).prev(a.config.newImagesBlock.selector).append(a.config.addImageInNewColorTemplate(f))},addNewImageOfExistingColor:function(){var b=$(this).closest(".controls").find(".element-item input"),c=0,d=$(this).closest(a.config.blocksOfExistingColor.selector).data("exist_color");if(0!=b.length){var e=[];b.each(function(){e.push($(this).data("images_counter"))}),c=e.max()+1}var f={color_id:d,images_counter:c};$(this).prev(a.config.newImagesBlock.selector).append(a.config.addImageInExistingColorTemplate(f))},removeNewElement:function(){$(this).closest(a.config.elementBlock.selector).remove()}};a.init({addNewGroupButton:$(".add-catalog-group"),addNewCollectionButton:$(".add-catalog-collection"),addNewColorButton:$(".add-catalog-color"),addNewImageInExistingColorButton:$(".add-catalog-image-of-exist-color"),addNewImageInNewColorButton:$(".add-catalog-image-of-new-color"),removeNewBlockButton:$(".remove-new-item"),removeExistingBlockButton:$(".remove-item"),addGroupTemplate:$("#catalog-group-template").html(),addCollectionTemplate:$("#catalog-collection-template").html(),addImageInNewColorTemplate:$("#catalog-image-of-new-color-template").html(),addImageInExistingColorTemplate:$("#catalog-image-of-exist-color-template").html(),addNewColorTemplate:$("#catalog-color-template").html(),newGroupsBlock:$(".catalog-groups"),newCollectionsBlock:$(".catalog-collections"),newColorsBlock:$(".catalog-colors"),newImagesBlock:$(".catalog-images"),blocksOfExistingColor:$(".catalog-color"),blocksOfNewColor:$(".catalog-new-color"),elementBlock:$(".element-item"),body:$("body")})});